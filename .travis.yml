dist: xenial

language: python
python: '3.7'

sudo: required
services:
  - docker

addons:
  apt:
    sources:
      - ubuntu-toolchain-r-test
    packages:
      - g++-7
      - g++-7-multilib
      - linux-libc-dev:i386

install:
  - curl -L https://github.com/docker/compose/releases/download/1.4.0/docker-compose-`uname -s`-`uname -m` > docker-compose
  - chmod +x docker-compose
  - sudo mv docker-compose /usr/local/bin
  - pip install conan sqflint

script:
  - sqflint --directory addons --exit w
  - docker-compose run package
  - mkdir build && cd build
  - CC=gcc-7 CXX=g++-7 cmake -DCMAKE_BUILD_TYPE=Release ..
  - make
  - make test
